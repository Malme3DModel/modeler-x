(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5152:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eo});var a=r(5155),s=r(2115),n=r(1364);let o={Radius:30,MeshRes:.1,"Cache?":!0,"GroundPlane?":!0,"Grid?":!0},l={theme:"vs-dark",language:"typescript",automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",tabSize:2,insertSpaces:!0},c={allowNonTsExtensions:!0,target:"ES2020",allowJs:!0,checkJs:!1,moduleResolution:"NodeJs",eagerModelSync:!0},i={cascadeStudio:"./js/CascadeStudioTypes.d.ts",standardLibrary:"./js/StandardLibraryIntellisense.js"};class d{constructor(){var e=this;this.isWorkingState=!1,this.evaluateCode=async(e,t)=>{let r=this.getWorkerInstance();if(!r||this.isWorking())throw Error("CAD Worker is not available or currently working");try{this.setWorking(!0),r.evaluateCode(e,t)}catch(e){throw this.setWorking(!1),e}},this.combineAndRenderShapes=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.getWorkerInstance();if(!a)throw Error("CAD Worker is not available");return new Promise(e=>{a.combineAndRenderShapes(t,r),setTimeout(e,100)})},this.isWorking=()=>this.isWorkingState||window.workerWorking,this.setWorking=e=>{this.isWorkingState=e,window.workerWorking=e},this.getWorkerInstance=()=>window.cadWorker,this.evaluateAndRender=async e=>{let{code:t,guiState:r,meshRes:a=.1,sceneOptions:s={},delay:n=100}=e;try{return await this.evaluateCode(t,r),new Promise((e,t)=>{setTimeout(async()=>{try{await this.combineAndRenderShapes(a,s),e()}catch(e){t(e)}},n)})}catch(e){throw this.setWorking(!1),e}},this.resetWorking=()=>{this.setWorking(!1)},window.workerWorking=!1}}let u=new d,p=()=>{let[e,t]=(0,s.useState)(!1),[r,a]=(0,s.useState)(!1),[n,l]=(0,s.useState)(null),c=(0,s.useRef)(null),i=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=()=>{let t=!!window.cadWorker;t&&!r?(a(!0),c.current&&(clearInterval(c.current),c.current=null)):!t&&r&&(a(!1),c.current||(c.current=setInterval(e,1e3)))};return e(),r||(c.current=setInterval(e,1e3)),()=>{c.current&&(clearInterval(c.current),c.current=null)}},[r]),(0,s.useEffect)(()=>{let r=()=>{let r=u.isWorking();r!==e&&t(r)};return r(),i.current=setInterval(r,500),()=>{i.current&&(clearInterval(i.current),i.current=null)}},[e]);let d=(0,s.useCallback)(async e=>{try{l(null),await e()}catch(r){let e=r instanceof Error?r.message:String(r);l(e),console.error("CAD Worker operation failed:",e),u.resetWorking(),t(!1)}},[]),p=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;await d(async()=>{await u.evaluateCode(e,t)})},[d]),h=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await d(async()=>{await u.combineAndRenderShapes(e,t)})},[d]),m=(0,s.useCallback)(async e=>{let{guiState:t=o,...r}=e;await d(async()=>{await u.evaluateAndRender({...r,guiState:t})})},[d]),f=(0,s.useCallback)(()=>{u.resetWorking(),t(!1),l(null)},[]);return{isWorking:e,isWorkerReady:r,error:n,evaluateCode:p,combineAndRenderShapes:h,evaluateAndRender:m,resetWorking:f,clearError:(0,s.useCallback)(()=>{l(null)},[]),checkWorkerStatus:(0,s.useCallback)(()=>u.isWorking(),[])}};class h{static async evaluateCode(e){let{editor:t,monaco:r,evaluateAndRender:a,extraLibs:s=[],saveToURL:n=!1,onEvaluate:l}=e,c=window.cadWorker;if(window.workerWorking)return void console.log("CAD Worker is currently working. Please wait...");if(!c)return void console.error("CAD Worker is not ready yet. Please wait for initialization.");try{r.languages.typescript.typescriptDefaults.setExtraLibs(s);let e=t.getValue();r.editor.setModelMarkers(t.getModel(),"test",[]),await a({code:e,meshRes:o.MeshRes,sceneOptions:{groundPlaneVisible:o["GroundPlane?"],gridVisible:o["Grid?"]},guiState:o,delay:100}),l&&l(),console.log("Generating Model with OpenCascade.js"),n&&console.log("Saved to URL!")}catch(e){throw console.error("Error evaluating code:",e),e}}static setupCodeFolding(e,t){let r=t.split(/\r\n|\r|\n/),a=[],s=null;for(let e=0;e<r.length;e++)r[e].startsWith("function")?s={startLineNumber:e+1}:r[e].startsWith("}")&&null!==s&&(s.endLineNumber=e+1,a.push(s),s=null);if(a.length>0){let t=Object.assign(e.saveViewState(),{contributionsState:{"editor.contrib.folding":{collapsedRegions:a,lineCount:r.length,provider:"indent"},"editor.contrib.wordHighlighter":!1}});e.restoreViewState(t)}}}class m{static async loadTypeDefinitions(e){this.extraLibs=[];try{return await this.loadCascadeStudioTypes("",e),await this.loadStandardLibraryTypes("",e),e.languages.typescript.typescriptDefaults.setExtraLibs(this.extraLibs),this.extraLibs}catch(e){throw console.error("Error loading type definitions:",e),e}}static async loadCascadeStudioTypes(e,t){try{let t=await fetch(e+i.cascadeStudio),r=await t.text();this.extraLibs.push({content:r,filePath:"file://"+i.cascadeStudio}),console.log("CascadeStudio type definitions loaded successfully")}catch(e){throw console.warn("Could not load CascadeStudio type definitions:",e),e}}static async loadStandardLibraryTypes(e,t){try{let r=await fetch(e+i.standardLibrary),a=await r.text();this.extraLibs.push({content:a,filePath:"file://"+i.standardLibrary.replace(".js",".d.ts")}),t.editor.createModel("","typescript"),console.log("StandardLibrary type definitions loaded successfully")}catch(e){throw console.warn("Could not load StandardLibrary type definitions:",e),e}}static getExtraLibs(){return[...this.extraLibs]}static clearTypeDefinitions(){this.extraLibs=[]}}m.extraLibs=[];class f{static setMonacoEditorRef(e){this.monacoEditorRef=e}static async executeCode(e){try{var t;if(!(null==(t=this.monacoEditorRef)?void 0:t.current))return{success:!1,error:"MonacoEditorが初期化されていません"};let r=this.monacoEditorRef.current,a=r.getValue(),s=a?"".concat(a,"\n\n// AI生成コード\n").concat(e):e;if(r.setValue(s),"function"==typeof r.evaluateCode)return await r.evaluateCode(),{success:!0,message:"コードが正常に実行されました"};return{success:!0,message:"コードがエディターに設定されました。手動で実行してください。"}}catch(e){return console.error("コード実行エラー:",e),{success:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}}}static addCodeToEditor(e){try{var t;if(!(null==(t=this.monacoEditorRef)?void 0:t.current))return{success:!1,error:"MonacoEditorが初期化されていません"};let r=this.monacoEditorRef.current,a=r.getValue(),s=a?"".concat(a,"\n\n// AI生成コード\n").concat(e):e;return r.setValue(s),r.focus(),{success:!0,message:"コードがエディターに追加されました"}}catch(e){return console.error("コード追加エラー:",e),{success:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}}}static getCurrentCode(){try{var e;if(!(null==(e=this.monacoEditorRef)?void 0:e.current))return null;return this.monacoEditorRef.current.getValue()}catch(e){return console.error("コード取得エラー:",e),null}}static clearEditor(){try{var e;if(!(null==(e=this.monacoEditorRef)?void 0:e.current))return{success:!1,error:"MonacoEditorが初期化されていません"};return this.monacoEditorRef.current.setValue(""),{success:!0,message:"エディターがクリアされました"}}catch(e){return console.error("エディタークリアエラー:",e),{success:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}}}}f.monacoEditorRef=null;let g=(0,s.memo)(e=>{let{value:t,onChange:r,onEvaluate:o,onSaveProject:i,hasUnsavedChanges:d,onUnsavedChangesUpdate:u,projectName:g,onProjectNameUpdate:x}=e,y=(0,s.useRef)(null),v=(0,s.useRef)(null),[b,w]=(0,s.useState)(!1),[C,j]=(0,s.useState)([]),k=(0,s.useRef)(t),{evaluateAndRender:E,isWorking:S,isWorkerReady:N,error:A,clearError:R}=p(),{setupEditorShortcuts:P}=function(e,t){let{onEvaluate:r,onSaveProject:a,onUnsavedChangesUpdate:n,onProjectNameUpdate:o,originalValue:l}=t,c=(0,s.useRef)(l||"");(0,s.useEffect)(()=>{void 0!==l&&(c.current=l)},[l]);let i=(0,s.useCallback)((e,t)=>{e.addCommand(t.KeyCode.F5,()=>{e.evaluateCode&&e.evaluateCode(!0)}),e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,()=>{e.evaluateCode&&e.evaluateCode(!0)}),e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KeyS,()=>{a&&a(),e.evaluateCode&&e.evaluateCode(!0)})},[a]);return(0,s.useEffect)(()=>{let t=t=>{var r,s;if("F5"===t.key)return t.preventDefault(),(null==(r=e.current)?void 0:r.evaluateCode)&&e.current.evaluateCode(!0),!1;(t.ctrlKey||t.metaKey)&&"s"===t.key&&(t.preventDefault(),a&&a(),(null==(s=e.current)?void 0:s.evaluateCode)&&e.current.evaluateCode(!0))},r=t=>{t.key&&e.current&&n&&n(e.current.getValue()!==c.current)};return document.addEventListener("keydown",t),document.addEventListener("keyup",r),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",r)}},[a,n,o,e]),{setupEditorShortcuts:i}}(y,{onEvaluate:o,onSaveProject:i,onUnsavedChangesUpdate:u,onProjectNameUpdate:x,originalValue:t});(0,s.useEffect)(()=>{k.current=t},[t]),(0,s.useEffect)(()=>{console.log("[MonacoEditor] useEffect: value=",t,", isLoaded=",b),b&&y.current&&y.current.getValue()!==t&&y.current.setValue(t)},[t,b]);let W=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!y.current||!v.current)return void console.warn("Editor or Monaco instance not ready");try{await h.evaluateCode({editor:y.current,monaco:v.current,evaluateAndRender:E,extraLibs:C,saveToURL:e,onEvaluate:o})}catch(e){console.error("Error during code evaluation:",e)}},[E,C,o]),D=(0,s.useCallback)(async(e,r)=>{y.current=e,v.current=r;try{r.languages.typescript.typescriptDefaults.setCompilerOptions(c);let a=await m.loadTypeDefinitions(r);j(a),e.evaluateCode=W,P(e,r),h.setupCodeFolding(e,t),f.setMonacoEditorRef(y),w(!0),console.log("Monaco Editor initialized successfully")}catch(e){console.error("Error initializing Monaco Editor:",e)}},[W,P,t]),L=(0,s.useCallback)(e=>{void 0!==e&&r&&r(e)},[r]),M=A?(0,a.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[(0,a.jsx)("strong",{children:"Error:"})," ",A,(0,a.jsx)("button",{onClick:R,className:"ml-2 text-red-500 hover:text-red-700",children:"\xd7"})]}):null;return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[M,(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(n.Ay,{height:"100%",defaultLanguage:"typescript",value:t,onChange:L,onMount:D,options:l,theme:"vs-dark"})})]})});g.displayName="MonacoEditor";var x=r(3264),y=r(7431),v=r(5416);let b=(0,s.forwardRef)((e,t)=>{let{onSceneReady:r}=e,n=(0,s.useRef)(null),o=(0,s.useRef)(null),l=(0,s.useRef)(null),c=(0,s.useRef)(null),i=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(null),[p,h]=(0,s.useState)(!1),m=(0,s.useRef)(null),f=(0,s.useRef)(null),g=(0,s.useRef)(null),b=(0,s.useCallback)((e,t)=>{if(!o.current||!m.current)return;o.current;let r=m.current;for(;r.children.length>0;){let e=r.children[0];r.remove(e),e instanceof x.eaF&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}let a=[],s=[];if(Array.isArray(e)&&e.length>=2)a=e[0]||[],s=e[1]||[];else{if(!e||!e.faceList)return void console.warn("No valid face data received from CAD worker");a=e.faceList||[],s=e.edgeList||[]}try{let e=new x.LoY,n=[],o=[],l=[],c=0;for(let e of a)if(e.vertex_coord&&e.normal_coord&&e.tri_indexes){let t=e.vertex_coord,r=e.normal_coord,a=e.tri_indexes;for(let e=0;e<t.length;e+=3)n.push(t[e],t[e+1],t[e+2]);for(let e=0;e<r.length;e+=3)o.push(r[e],r[e+1],r[e+2]);for(let e=0;e<a.length;e++)l.push(a[e]+c);c+=t.length/3}if(n.length>0){e.setAttribute("position",new x.qtW(n,3)),e.setAttribute("normal",new x.qtW(o,3)),e.setIndex(l),e.computeBoundingSphere();let t=getComputedStyle(document.documentElement).getPropertyValue("--threejs-viewport-face").trim()||"#cccccc",a=new x.FNr({color:new x.Q1f(t),polygonOffset:!0,polygonOffsetFactor:2,polygonOffsetUnits:1});new x.Tap().load("/textures/dullFrontLitMetal.png",e=>{a.matcap=e,a.needsUpdate=!0},void 0,()=>{console.warn("Could not load matcap texture, using basic material")});let s=new x.eaF(e,a);s.castShadow=!0,s.name="Model Faces",r.add(s),console.log("Rendered CAD model with ".concat(n.length/3," vertices and ").concat(l.length/3," triangles"))}if(s&&s.length>0){let e=new x.LoY,t=[];for(let e of s)if(e.vertex_coord)for(let r=0;r<e.vertex_coord.length;r+=3)t.push(e.vertex_coord[r],e.vertex_coord[r+1],e.vertex_coord[r+2]);if(t.length>0){let a=getComputedStyle(document.documentElement).getPropertyValue("--threejs-viewport-wireframe").trim()||"#999999";e.setAttribute("position",new x.qtW(t,3));let s=new x.mrM({color:a,linewidth:1}),n=new x.DXC(e,s);n.name="Model Edges",r.add(n)}}t&&(f.current&&(f.current.visible=!1!==t.groundPlaneVisible),g.current&&(g.current.visible=!1!==t.gridVisible))}catch(e){console.error("Error processing CAD mesh data:",e)}},[]);(0,s.useImperativeHandle)(t,()=>({updateShape:b}),[b]);let w=(0,s.useCallback)(()=>{if(!o.current)return;let e=o.current;for(;e.children.length>0;){let t=e.children[0];e.remove(t),t instanceof x.eaF&&(t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach(e=>e.dispose()):t.material.dispose())}let t=new x.$p8(0xffffff,.5);e.add(t);let a=new x.ZyN(0xffffff,.8);a.position.set(1,1,1),e.add(a),e.background=new x.Q1f(2236962),e.fog=new x.jUj(2236962,200,600);let s=new x.IzY(50);e.add(s);let n=new x.YJl;n.name="CAD Model Container",n.rotation.x=-Math.PI/2,e.add(n),m.current=n;let l=new x.fTw(2e3,20,0xcccccc,0xcccccc);l.position.y=-.01,l.material.opacity=.3,l.material.transparent=!0,e.add(l),g.current=l;let c=new x.bdM(2e3,2e3),i=new x.tXL({color:526344,depthWrite:!0,dithering:!0,polygonOffset:!0,polygonOffsetFactor:6,polygonOffsetUnits:1}),d=new x.eaF(c,i);d.position.y=-.1,d.rotation.x=-Math.PI/2,d.receiveShadow=!0,d.name="Ground Plane",e.add(d),f.current=d,r&&r(e)},[r]);return(0,s.useEffect)(()=>{if(!n.current)return;o.current=new x.Z58;let e=new y.JeP({antialias:!0});e.setPixelRatio(1),e.shadowMap.enabled=!0,e.shadowMap.type=x.Wk7;let{clientWidth:t,clientHeight:r}=n.current;console.log("マウント要素の実際のサイズ: ".concat(t,"x").concat(r));let a=t>0&&t<3e3?t:800,s=r>0&&r<3e3?r:600;e.setSize(a,s),n.current.appendChild(e.domElement);let p=e.domElement;p.style.position="absolute",p.style.top="0",p.style.left="0",p.style.width="100%",p.style.height="100%",p.style.zIndex="10",p.style.pointerEvents="auto",p.style.touchAction="none",l.current=e;let m=new x.ubm(45,a/s,1,5e3);m.position.set(50,100,150),m.lookAt(0,45,0),c.current=m;let f=new v.N(m,p);f.target.set(0,45,0),f.enableDamping=!0,f.dampingFactor=.05,f.panSpeed=2,f.zoomSpeed=1,f.rotateSpeed=1,f.minDistance=5,f.maxDistance=500,f.enablePan=!0,f.enableRotate=!0,f.enableZoom=!0,f.screenSpacePanning=!0,f.update(),i.current=f,w();let g=new ResizeObserver(()=>{if(!n.current||!l.current||!c.current)return;let{clientWidth:e,clientHeight:t}=n.current,r=e>0&&e<3e3?e:800,a=t>0&&t<3e3?t:600;if(l.current.domElement.width===r&&l.current.domElement.height===a)return;l.current.setPixelRatio(1),l.current.setSize(r,a,!0);let s=l.current.domElement;s.style.width="100%",s.style.height="100%",c.current.aspect=r/a,c.current.updateProjectionMatrix()});n.current&&g.observe(n.current),u.current=g;let b=()=>{l.current&&o.current&&c.current&&i.current&&(d.current=requestAnimationFrame(b),i.current.update(),l.current.render(o.current,c.current))};return b(),h(!0),()=>{d.current&&cancelAnimationFrame(d.current),u.current&&n.current&&(u.current.unobserve(n.current),u.current.disconnect()),l.current&&n.current&&(n.current.removeChild(l.current.domElement),l.current.dispose()),o.current&&o.current.traverse(e=>{e instanceof x.eaF&&(e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material&&e.material.dispose())}),i.current&&i.current.dispose()}},[w]),(0,a.jsx)("div",{className:"relative h-full w-full",children:(0,a.jsx)("div",{ref:n,className:"absolute inset-0 w-full h-full",children:!p&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:"Loading Viewport..."})})})});b.displayName="ThreeViewport";var w=r(3885);r(5188);let C={LEFT_PANEL_RATIO:.7,TOTAL_PANELS:3,ANIMATION_FRAMES:2},j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"h-full w-full flex flex-col overflow-hidden",t=arguments.length>1?arguments[1]:void 0;return s.memo(r=>{let{params:s}=r,n=null==s?void 0:s.content;return(0,a.jsx)("div",{className:e,style:t,"data-panel-initialized":"true",children:n})})},k=j(),E=j("h-full w-full flex flex-col overflow-hidden",{pointerEvents:"auto",touchAction:"auto",position:"relative",zIndex:1}),S=j("h-full w-full flex flex-col overflow-auto"),N=e=>{let{editorPanel:t,cadViewPanel:r,consolePanel:n,editorTitle:o="* Untitled.ts"}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(null),i=(0,s.useRef)(null),d=(0,s.useMemo)(()=>[{id:"viewport",component:"viewport",title:"CAD View"},{id:"editor",component:"editor",title:o,position:{referencePanel:"viewport",direction:"within"}},{id:"console",component:"console",title:"Console",position:{referencePanel:"viewport",direction:"right"}}],[o]),u=(0,s.useMemo)(()=>({viewport:r,editor:t,console:n}),[r,t,n]),p=(0,s.useCallback)(()=>{if(l.current&&c.current)try{let e=l.current.getPanel("viewport"),t=l.current.getPanel("console");if((null==e?void 0:e.group)&&(null==t?void 0:t.group)){let r=c.current.clientWidth,a=Math.floor(r*C.LEFT_PANEL_RATIO);e.group.api.setSize({width:a}),t.group.api.setSize({width:r-a})}}catch(e){console.error("Layout proportion error:",e)}},[]),h=(0,s.useCallback)(()=>{if(l.current)try{let e=l.current.getPanel("viewport");null==e||e.api.setActive(),c.current&&!i.current&&(i.current=new ResizeObserver(p),i.current.observe(c.current));let t=e=>{e>0?requestAnimationFrame(()=>t(e-1)):p()};t(C.ANIMATION_FRAMES)}catch(e){console.error("Layout initialization error:",e)}},[p]),m=(0,s.useCallback)(()=>{let e=0;return()=>{++e===C.TOTAL_PANELS&&h()}},[h]),f=(0,s.useCallback)(e=>{l.current=e.api;let t=m();d.forEach(r=>{e.api.addPanel({id:r.id,component:r.component,params:{content:u[r.id]},title:r.title,...r.position&&{position:r.position}}),t()})},[d,u,m]);(0,s.useEffect)(()=>()=>{i.current&&(i.current.disconnect(),i.current=null)},[]),(0,s.useEffect)(()=>{if(l.current){let e=l.current.getPanel("editor");e&&e.api.setTitle(o)}},[o]);let g=(0,s.useMemo)(()=>({editor:k,viewport:E,console:S}),[]);return(0,a.jsx)("div",{ref:c,className:"h-full w-full",children:(0,a.jsx)(w.UY,{onReady:f,components:g,className:"h-full w-full",theme:w.Qy,disableFloatingGroups:!0})})},A=e=>{let{onWorkerReady:t,onShapeUpdate:r,onProgress:a,onLog:n,onError:o,autoEvaluateCode:l}=e,c=(0,s.useRef)(null),i=(0,s.useRef)({}),d=(0,s.useRef)(!1),p=(0,s.useCallback)(()=>({evaluateCode:(e,t)=>{c.current&&!d.current&&(d.current=!0,window.workerWorking=!0,c.current.postMessage({type:"Evaluate",payload:{code:e,GUIState:t}}))},combineAndRenderShapes:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.current&&c.current.postMessage({type:"combineAndRenderShapes",payload:{maxDeviation:e,sceneOptions:t}})},get isWorking(){return d.current}}),[]),h=(0,s.useRef)(!1),m=(0,s.useCallback)(e=>{l&&!h.current&&(h.current=!0,n&&n("Auto-evaluating startup code..."),e.evaluateCode(l,{}),e.combineAndRenderShapes(),n&&n("Startup code evaluation completed"))},[l,n]);return(0,s.useEffect)(()=>{try{c.current=new Worker("./js/CascadeStudioMainWorker.js"),i.current={startupCallback:()=>{console.log("CAD Kernel loaded successfully!");let e=p();return window.cadWorker=e,m(e),t&&t(),null},combineAndRenderShapes:e=>{let[t,a]=e;return r&&r(t,a),null},Progress:e=>(a&&a(e),null),log:e=>(n&&n(e),null),error:e=>(d.current=!1,window.workerWorking=!1,window.cadWorkerService&&window.cadWorkerService.resetWorking(),o&&o(e),null),resetWorking:()=>(d.current=!1,window.workerWorking=!1,window.cadWorkerService&&window.cadWorkerService.resetWorking(),null),apiInvestigation:e=>(console.log("=== API Investigation Results ==="),console.log("All gp_Trsf methods:",e.trsfMethods),console.log("Rotation-related methods:",e.rotationMethods),console.log("Set methods:",e.setMethods),console.log("=== End API Investigation ==="),null)},c.current.onmessage=e=>{let{type:t,payload:r}=e.data;if(t in i.current){let e=i.current[t](r);if(e){var a;null==(a=c.current)||a.postMessage({type:t,payload:e})}}},c.current.onerror=e=>{console.error("CAD Worker Error:",e),d.current=!1,window.workerWorking=!1,o&&o("Worker Error: ".concat(e.message))},window.workerWorking=!1,window.cadWorkerService=u}catch(e){console.error("Failed to create CAD Worker:",e),o&&o("Failed to create CAD Worker: ".concat(e))}return()=>{c.current&&(c.current.terminate(),c.current=null),delete window.cadWorker,delete window.workerWorking,delete window.cadWorkerService}},[t,r,a,n,o,m,p]),null};var R=r(5339),P=r(1007),W=r(5657),D=r(9621),L=r(4357),M=r(333),T=r(5580),O=r(2486);let _=e=>{let{className:t="",onExecuteCode:r}=e,[n,o]=(0,s.useState)([{id:"1",type:"assistant",content:"こんにちは！CADモデリングについて何でもお聞きください。OpenCascade.jsを使用したコードの改善提案や3Dモデリングのヘルプができます。\n\n例えば「箱と球体を組み合わせた形状を作って」と言ってみてください。実行可能なコードを生成します！",timestamp:new Date}]),[l,c]=(0,s.useState)(""),[i,d]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),h=(0,s.useRef)(null),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},[n]),(0,s.useEffect)(()=>{m.current&&(m.current.style.height="auto",m.current.style.height="".concat(m.current.scrollHeight,"px"))},[l]);let g=e=>{let t=e.match(/```(?:typescript|ts)\n([\s\S]*?)```/g);return t&&t.length>0?t[0].replace(/```(?:typescript|ts)\n/,"").replace(/```$/,"").trim():null},x=async()=>{if(!l.trim()||i)return;let e={id:Date.now().toString(),type:"user",content:l.trim(),timestamp:new Date};o(t=>[...t,e]),c(""),d(!0),p(null);try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...n,e]})});if(!t.ok){let e=await t.json();throw Error(e.error||"HTTP error! status: ".concat(t.status))}let a=await t.json(),s=g(a.message),l=s?a.message.replace(/```(?:typescript|ts)\n[\s\S]*?```/g,"").trim():a.message,c={id:(Date.now()+1).toString(),type:"assistant",content:l,timestamp:new Date,extractedCode:s||void 0};o(e=>[...e,c]),s&&(r?r(s):(f.clearEditor(),f.executeCode(s)))}catch(r){console.error("チャットエラー:",r);let e=r instanceof Error?r.message:"不明なエラーが発生しました";p(e);let t={id:(Date.now()+1).toString(),type:"assistant",content:"申し訳ございません。エラーが発生しました: ".concat(e),timestamp:new Date};o(e=>[...e,t])}finally{d(!1)}},y=e=>{navigator.clipboard.writeText(e)},v=e=>e.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});return(0,a.jsxs)("div",{className:"h-full flex flex-col bg-gray-50 ".concat(t),children:[u&&(0,a.jsx)("div",{className:"flex-shrink-0 p-2 bg-red-50 border-b border-red-200",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-700 text-xs",children:[(0,a.jsx)(R.A,{size:14}),(0,a.jsx)("span",{children:u}),(0,a.jsx)("button",{onClick:()=>p(null),className:"ml-auto text-red-500 hover:text-red-700",children:"\xd7"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[n.map(e=>(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("div",{className:"w-full rounded-lg p-2 text-xs ".concat("user"===e.type?"bg-blue-500 text-white":"bg-white border border-gray-200 text-gray-800"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-1",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:"user"===e.type?(0,a.jsx)(P.A,{size:12,className:"mt-0.5"}):(0,a.jsx)(W.A,{size:12,className:"mt-0.5 text-blue-500"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e.content}),"assistant"===e.type&&e.extractedCode&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-600 flex items-center",children:[(0,a.jsx)(D.A,{size:10,className:"mr-1"}),"実行可能なコード"]}),(0,a.jsx)("div",{className:"flex space-x-1",children:(0,a.jsx)("button",{onClick:()=>y(e.extractedCode),className:"p-1 hover:bg-gray-200 rounded transition-colors",title:"コードをコピー",children:(0,a.jsx)(L.A,{size:10,className:"text-gray-500"})})})]}),(0,a.jsx)("pre",{className:"text-xs text-gray-700 bg-white p-1 rounded border overflow-x-auto",children:(0,a.jsx)("code",{children:e.extractedCode})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsx)("span",{className:"text-xs ".concat("user"===e.type?"text-blue-100":"text-gray-500"),children:v(e.timestamp)}),"assistant"===e.type&&(0,a.jsxs)("div",{className:"flex space-x-0.5",children:[(0,a.jsx)("button",{onClick:()=>y(e.content),className:"p-0.5 hover:bg-gray-100 rounded transition-colors",title:"コピー","aria-label":"コピー",children:(0,a.jsx)(L.A,{size:10,className:"text-gray-500"})}),(0,a.jsx)("button",{className:"p-0.5 hover:bg-gray-100 rounded transition-colors",title:"いいね","aria-label":"いいね",children:(0,a.jsx)(M.A,{size:10,className:"text-gray-500"})}),(0,a.jsx)("button",{className:"p-0.5 hover:bg-gray-100 rounded transition-colors",title:"よくない","aria-label":"よくない",children:(0,a.jsx)(T.A,{size:10,className:"text-gray-500"})})]})]})]})]})})},e.id)),i&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-2 w-full text-xs",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(W.A,{size:12,className:"text-blue-500"}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,a.jsx)("div",{ref:h})]}),(0,a.jsxs)("div",{className:"flex-shrink-0 p-3 border-t border-gray-200 bg-white",children:[(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("textarea",{ref:m,value:l,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())},placeholder:"メッセージを入力してください... (Enter で送信、Shift+Enter で改行)",className:"w-full p-2 pr-8 border border-gray-300 rounded text-xs resize-none focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent",rows:1,style:{minHeight:"32px",maxHeight:"80px"},disabled:i}),(0,a.jsx)("button",{onClick:x,disabled:!l.trim()||i,className:"absolute right-1 top-1/2 transform -translate-y-1/2 p-1 text-blue-500 hover:text-blue-600 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors","aria-label":"メッセージを送信",title:"メッセージを送信",children:(0,a.jsx)(O.A,{size:14})})]})}),(0,a.jsx)("div",{className:"mt-1 text-xs text-gray-500",children:"ChatGPT (GPT-3.5-turbo) を使用しています。CADモデリングについてお気軽にご質問ください。"})]})]})};var U=r(2596),I=r(9688);function F(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,I.QP)((0,U.$)(t))}let z={bg:{primary:"bg-vs-bg",secondary:"bg-vs-bg-secondary",tertiary:"bg-vs-bg-tertiary"},text:{primary:"text-vs-fg",secondary:"text-vs-fg-secondary",muted:"text-vs-fg-muted"},border:{primary:"border-vs-border",light:"border-vs-border-light"}},V={header:F(z.bg.secondary,z.text.primary,z.border.primary,"border-b"),footer:F(z.bg.secondary,z.text.primary,z.border.primary,"border-t"),buttonPrimary:F("bg-vs-btn-bg text-vs-btn-fg","hover:bg-vs-btn-bg-hover","border border-vs-border","px-4 py-2 rounded","transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-vs-accent"),buttonSecondary:F("bg-transparent text-vs-fg","hover:bg-vs-dropdown-hover","border border-vs-border","px-4 py-2 rounded","transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-vs-accent"),buttonGhost:F("bg-transparent text-vs-fg","hover:bg-vs-dropdown-hover","px-2 py-1 rounded","transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-vs-accent"),input:F("bg-vs-input-bg text-vs-input-fg","border border-vs-input-border","px-3 py-2 rounded","focus:outline-none focus:ring-2 focus:ring-vs-accent","placeholder:text-vs-fg-muted"),dropdown:F("bg-vs-dropdown-bg text-vs-fg","border border-vs-dropdown-border","rounded shadow-lg","min-w-[120px]"),dropdownItem:F("w-full flex items-center space-x-2","px-3 py-2 text-xs text-left","text-vs-fg hover:bg-vs-dropdown-hover","transition-colors duration-150","focus:outline-none focus:bg-vs-dropdown-hover"),card:F(z.bg.secondary,z.text.primary,z.border.primary,"border rounded p-4"),panel:F(z.bg.primary,z.text.primary,z.border.primary)},G=e=>{let{className:t="w-4 h-4",style:r={}}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:r,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"})})},J=e=>{let{className:t="w-4 h-4",style:r={}}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:r,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})})},B=e=>{let{className:t="w-4 h-4",style:r={}}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:r,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},K=e=>{let{className:t="w-4 h-4",style:r={}}=e;return(0,a.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:r,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})},H=e=>{let{onSaveProject:t,onLoadProject:r,onSaveSTEP:n,onSaveSTL:o,onSaveOBJ:l}=e,[c,i]=(0,s.useState)(!1);return(0,a.jsxs)("div",{className:F("flex items-center justify-between h-8 px-3",V.header),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-sm flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-bold",children:"X"})}),(0,a.jsx)("span",{className:"font-medium",children:"Modeler X"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,a.jsxs)("button",{onClick:t,className:F("flex items-center space-x-1.5",V.buttonGhost),title:"Save Project (.json)",children:[(0,a.jsx)(G,{className:"w-3.5 h-3.5 group-hover:opacity-100 transition-opacity"}),(0,a.jsx)("span",{className:"text-xs",children:"Save"})]}),r&&(0,a.jsxs)("button",{onClick:r,className:F("flex items-center space-x-1.5",V.buttonGhost),title:"Load Project (.json)",children:[(0,a.jsx)(J,{className:"w-3.5 h-3.5 group-hover:opacity-100 transition-opacity"}),(0,a.jsx)("span",{className:"text-xs",children:"Load"})]})]}),(n||o||l)&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>i(!c),className:F("flex items-center space-x-1",V.buttonGhost),title:"Export Options",children:[(0,a.jsx)(B,{className:"w-3.5 h-3.5 group-hover:opacity-100 transition-opacity"}),(0,a.jsx)("span",{className:"text-xs",children:"Export"}),(0,a.jsx)(K,{className:"w-3 h-3 group-hover:opacity-100 transition-all duration-150"})]}),c&&(0,a.jsxs)("div",{className:F("absolute top-full left-0 mt-1 z-50",V.dropdown),children:[n&&(0,a.jsxs)("button",{onClick:()=>{n(),i(!1)},className:V.dropdownItem,children:[(0,a.jsx)("span",{children:"●"}),(0,a.jsx)("span",{children:"STEP Format"})]}),o&&(0,a.jsxs)("button",{onClick:()=>{o(),i(!1)},className:V.dropdownItem,children:[(0,a.jsx)("span",{children:"●"}),(0,a.jsx)("span",{children:"STL Format"})]}),l&&(0,a.jsxs)("button",{onClick:()=>{l(),i(!1)},className:V.dropdownItem,children:[(0,a.jsx)("span",{children:"●"}),(0,a.jsx)("span",{children:"OBJ Format"})]})]})]})]})]}),c&&(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>i(!1)})]})},Y=(0,s.memo)(e=>{let{isCADWorkerReady:t,isWorking:r,isWorkerReady:s,hasUnsavedChanges:n,error:o}=e;return(0,a.jsxs)("div",{className:F("shrink-0 flex items-center justify-between h-6 px-3 text-xs",V.footer),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{children:"CAD Kernel:"}),(0,a.jsx)("span",{children:t?"✅ Ready":"⏳ Initializing..."})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{children:"Worker:"}),(0,a.jsx)("span",{children:s?"✅ Ready":"⏳ Loading..."})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{children:"Status:"}),(0,a.jsx)("span",{children:r?"\uD83D\uDD04 Working...":"✅ Idle"})]}),n&&(0,a.jsx)("div",{className:"flex items-center space-x-1",children:(0,a.jsx)("span",{children:"● Unsaved changes"})}),o&&(0,a.jsx)("div",{className:"flex items-center space-x-1",children:(0,a.jsx)("span",{children:"⚠️ Error"})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("span",{children:"Ctrl+Enter: evaluate"}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:"F5: update"}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:"Ctrl+S: save"})]})]})});Y.displayName="Footer";let q='// Welcome to Cascade Studio!   Here are some useful functions:\n//  Translate(), Rotate(), Scale(), Mirror(), Union(), Difference(), Intersection()\n//  Box(), Sphere(), Cylinder(), Cone(), Text3D(), Polygon()\n//  Offset(), Extrude(), RotatedExtrude(), Revolve(), Pipe(), Loft(), \n//  FilletEdges(), ChamferEdges(),\n//  Slider(), Checkbox(), TextInput(), Dropdown()\n\nlet holeRadius = Slider("Radius", 30 , 20 , 40);\n\nlet sphere     = Sphere(50);\nlet cylinderZ  =                     Cylinder(holeRadius, 200, true);\nlet cylinderY  = Rotate([0,1,0], 90, Cylinder(holeRadius, 200, true));\nlet cylinderX  = Rotate([1,0,0], 90, Cylinder(holeRadius, 200, true));\n\nTranslate([0, 0, 50], Difference(sphere, [cylinderX, cylinderY, cylinderZ]));\n\nTranslate([-25, 0, 40], Text3D("Hi!", 36, 0.15, \'Consolas\'));\n\n// Don\'t forget to push imported or oc-defined shapes into sceneShapes to add them to the workspace!',X={projectName:"Untitled",code:q,hasUnsavedChanges:!1,isCADWorkerReady:!1,consoleMessages:["> Welcome to Modeler X!","> Loading CAD Kernel..."],currentProgressMessage:""},Q=(e,t)=>{switch(t.type){case"SET_PROJECT_NAME":return{...e,projectName:t.payload,hasUnsavedChanges:!0};case"SET_CODE":return{...e,code:t.payload,hasUnsavedChanges:!0};case"SET_UNSAVED_CHANGES":return{...e,hasUnsavedChanges:t.payload};case"SET_CAD_WORKER_READY":return{...e,isCADWorkerReady:t.payload};case"ADD_CONSOLE_MESSAGE":return{...e,consoleMessages:[...e.consoleMessages,t.payload]};case"ADD_CONSOLE_MESSAGES":return{...e,consoleMessages:[...e.consoleMessages,...t.payload]};case"UPDATE_PROGRESS_MESSAGE":return{...e,currentProgressMessage:t.payload};case"CLEAR_CONSOLE":return{...e,consoleMessages:[],currentProgressMessage:""};case"SAVE_PROJECT":return{...e,hasUnsavedChanges:!1,lastSaved:new Date};case"RESET_PROJECT":return{...X,...t.payload};default:return e}},Z=(0,s.createContext)(null),$=e=>{let{children:t,initialProjectState:r={},onSaveProject:n,onShapeUpdate:o}=e,[l,c]=(0,s.useReducer)(Q,{...X,...r}),i=(0,s.useCallback)(e=>{c({type:"SET_PROJECT_NAME",payload:e})},[]),d=(0,s.useCallback)(e=>{c({type:"SET_CODE",payload:e})},[]),u=(0,s.useCallback)(e=>{c({type:"SET_UNSAVED_CHANGES",payload:e})},[]),p=(0,s.useCallback)(e=>{c({type:"SET_CAD_WORKER_READY",payload:e})},[]),h=(0,s.useCallback)(e=>{c({type:"ADD_CONSOLE_MESSAGE",payload:e})},[]),m=(0,s.useCallback)(e=>{c({type:"ADD_CONSOLE_MESSAGES",payload:e})},[]),f=(0,s.useCallback)(e=>{c({type:"UPDATE_PROGRESS_MESSAGE",payload:e})},[]),g=(0,s.useCallback)(()=>{c({type:"CLEAR_CONSOLE"})},[]),x=(0,s.useCallback)(()=>{n&&n(l.projectName,l.code),console.log("Saving project:",l.projectName),c({type:"SAVE_PROJECT"})},[n,l.projectName,l.code]),y=(0,s.useCallback)(e=>{c({type:"RESET_PROJECT",payload:e})},[]),v=(0,s.useCallback)(()=>"".concat(l.hasUnsavedChanges?"* ":"").concat(l.projectName,".ts"),[l.hasUnsavedChanges,l.projectName]),b=(0,s.useCallback)(()=>{p(!0),h("CAD Worker is ready!")},[p,h]),w=(0,s.useCallback)((e,t)=>{o&&o(e,t),h("Shape updated successfully")},[o,h]),C=(0,s.useCallback)(e=>{f("Progress: Operation ".concat(e.opNumber," - ").concat(e.opType))},[f]),j=(0,s.useCallback)(e=>{h("[CAD Worker]: ".concat(e))},[h]),k=(0,s.useCallback)(e=>{h("[ERROR]: ".concat(e)),console.error("CAD Worker Error:",e)},[h]);return(0,a.jsx)(Z.Provider,{value:{state:l,setProjectName:i,setCode:d,setUnsavedChanges:u,setCADWorkerReady:p,addConsoleMessage:h,addConsoleMessages:m,updateProgressMessage:f,clearConsole:g,saveProject:x,resetProject:y,getEditorTitle:v,handleWorkerReady:b,handleShapeUpdate:w,handleProgress:C,handleLog:j,handleError:k},children:t})},ee=()=>{let e=(0,s.useContext)(Z);if(!e)throw Error("useProjectContext must be used within a ProjectProvider");return e},et=()=>{let e=ee(),t=(0,s.useCallback)(t=>{e.setCode(t)},[e]),r=(0,s.useCallback)(()=>{console.log("Code evaluation triggered")},[]),a=(0,s.useCallback)(()=>{e.saveProject()},[e]),n=(0,s.useCallback)(t=>{e.setProjectName(t)},[e]),o=(0,s.useCallback)(t=>{e.setUnsavedChanges(t)},[e]),l=(0,s.useCallback)(()=>{e.resetProject()},[e]),c={onWorkerReady:e.handleWorkerReady,onShapeUpdate:e.handleShapeUpdate,onProgress:e.handleProgress,onLog:e.handleLog,onError:e.handleError};return{projectName:e.state.projectName,code:e.state.code,hasUnsavedChanges:e.state.hasUnsavedChanges,isCADWorkerReady:e.state.isCADWorkerReady,consoleMessages:e.state.consoleMessages,setProjectName:e.setProjectName,setCode:e.setCode,setUnsavedChanges:e.setUnsavedChanges,setCADWorkerReady:e.setCADWorkerReady,addConsoleMessage:e.addConsoleMessage,clearConsole:e.clearConsole,saveProject:e.saveProject,resetProject:l,editorTitle:e.getEditorTitle(),handleCodeChange:t,handleEvaluate:r,handleSaveProject:a,handleProjectNameUpdate:n,handleUnsavedChangesUpdate:o,cadWorkerCallbacks:c}};class er{static saveProject(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={name:e,code:t,version:"1.0.0",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};r.includeMetadata||(delete a.version,delete a.createdAt,delete a.updatedAt);let s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download=r.filename||"".concat(e,".json"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}static async loadProject(){return new Promise(e=>{let t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=t=>{var r;let a=null==(r=t.target.files)?void 0:r[0];if(!a)return void e({success:!1,error:"No file selected"});let s=new FileReader;s.onload=t=>{try{var r;let a=null==(r=t.target)?void 0:r.result,s=this.parseProjectData(a);this.validateProjectData(s)?e({success:!0,data:s}):e({success:!1,error:"Invalid project file format"})}catch(t){e({success:!1,error:"Failed to parse project file: ".concat(t instanceof Error?t.message:"Unknown error")})}},s.onerror=()=>{e({success:!1,error:"Failed to read file"})},s.readAsText(a)},t.click()})}static parseProjectData(e){let t=JSON.parse(e);return{name:t.name||"Untitled",code:t.code||"",version:t.version,createdAt:t.createdAt,updatedAt:t.updatedAt}}static validateProjectData(e){return"object"==typeof e&&null!==e&&"string"==typeof e.name&&"string"==typeof e.code}static migrateProjectData(e){return e.script&&!e.code&&(e.code=e.script,delete e.script),e.name&&""!==e.name.trim()||(e.name="Untitled"),e}}class ea{static async exportSTEP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return console.log("Exporting to STEP format:",{cadData:e,options:t}),this.simulateExport("step",t)}catch(e){return{success:!1,error:"STEP export failed: ".concat(e instanceof Error?e.message:"Unknown error")}}}static async exportSTL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return console.log("Exporting to STL format:",{cadData:e,options:t}),this.simulateExport("stl",t)}catch(e){return{success:!1,error:"STL export failed: ".concat(e instanceof Error?e.message:"Unknown error")}}}static async exportOBJ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return console.log("Exporting to OBJ format:",{cadData:e,options:t}),this.simulateExport("obj",t)}catch(e){return{success:!1,error:"OBJ export failed: ".concat(e instanceof Error?e.message:"Unknown error")}}}static async exportModel(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(e){case"step":return this.exportSTEP(t,r);case"stl":return this.exportSTL(t,r);case"obj":return this.exportOBJ(t,r);default:return{success:!1,error:"Unsupported export format: ".concat(e)}}}static simulateExport(e,t){let r=t.filename||"model.".concat(e),a=e.toUpperCase();return alert("".concat(a," export functionality will be implemented when CAD Worker integration is complete.\n\nPlanned features:\n- High-quality ").concat(a," export\n- Custom filename: ").concat(r,"\n- Quality settings: ").concat(t.quality||"medium","\n- Units: ").concat(t.units||"mm")),{success:!0,error:void 0}}static getSupportedFormats(){return["step","stl","obj"]}static getFormatInfo(e){return({step:{name:"STEP",description:"Standard for Exchange of Product Data",extension:"step",useCase:"High-precision CAD interchange, manufacturing"},stl:{name:"STL",description:"Stereolithography file format",extension:"stl",useCase:"3D printing, rapid prototyping"},obj:{name:"OBJ",description:"Wavefront OBJ 3D model format",extension:"obj",useCase:"3D graphics, game development, visualization"}})[e]}}let es=()=>{let[e,t]=(0,s.useState)(!1),[r,a]=(0,s.useState)(null),n=(0,s.useCallback)(()=>{a(null)},[]),o=(0,s.useCallback)(async(e,r,s)=>{try{t(!0),a(null),er.saveProject(e,r,s),console.log("Project saved successfully:",e)}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";a("Save failed: ".concat(e)),console.error("Project save error:",t)}finally{t(!1)}},[]),l=(0,s.useCallback)(async()=>{try{t(!0),a(null);let e=await er.loadProject();if(e.success&&e.data)return console.log("Project loaded successfully:",e.data.name),e.data;return a(e.error||"Failed to load project"),null}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return a("Load failed: ".concat(e)),console.error("Project load error:",t),null}finally{t(!1)}},[]),c=(0,s.useCallback)(async(e,r,s)=>{try{t(!0),a(null);let n=await ea.exportModel(e,r,s);return n.success?console.log("".concat(e.toUpperCase()," export completed successfully")):a(n.error||"".concat(e.toUpperCase()," export failed")),n}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return a("Export failed: ".concat(e)),console.error("Export error:",t),{success:!1,error:e}}finally{t(!1)}},[]),i=(0,s.useCallback)(async(e,t)=>c("step",e,t),[c]),d=(0,s.useCallback)(async(e,t)=>c("stl",e,t),[c]),u=(0,s.useCallback)(async(e,t)=>c("obj",e,t),[c]);return{isLoading:e,lastError:r,saveProject:o,loadProject:l,exportModel:c,exportSTEP:i,exportSTL:d,exportOBJ:u,clearError:n,getSupportedFormats:(0,s.useCallback)(()=>ea.getSupportedFormats(),[]),getFormatInfo:(0,s.useCallback)(e=>ea.getFormatInfo(e),[])}};function en(){let{code:e,editorTitle:t,isCADWorkerReady:r,consoleMessages:n,hasUnsavedChanges:o,projectName:l,handleCodeChange:c,handleEvaluate:i,handleSaveProject:d,handleProjectNameUpdate:u,handleUnsavedChangesUpdate:h,cadWorkerCallbacks:m}=et(),{saveProject:x,loadProject:y,exportSTEP:v,exportSTL:w,exportOBJ:C,isLoading:j,lastError:k}=es(),{isWorking:E,isWorkerReady:S,error:R}=p(),P=(0,s.useRef)(null),W=(0,s.useCallback)((e,t)=>{var r;(null==(r=P.current)?void 0:r.updateShape)&&P.current.updateShape(e,t)},[]),D=(0,s.useCallback)(e=>{},[]),L=(0,s.useCallback)(async()=>{let e=await y();e&&(c(e.code),u(e.name))},[y,c,u]),M=(0,s.useCallback)(async()=>{await x(l,e)},[x,l,e]),T=(0,s.useCallback)(async()=>{await v()},[v]),O=(0,s.useCallback)(async()=>{await w()},[w]),U=(0,s.useCallback)(async()=>{await C()},[C]),I=(0,a.jsx)(g,{value:e,onChange:c,onEvaluate:i,onSaveProject:d,hasUnsavedChanges:o,onUnsavedChangesUpdate:h,projectName:l,onProjectNameUpdate:u}),F=(0,a.jsx)(b,{ref:P,onSceneReady:D}),z=(0,a.jsx)(_,{onExecuteCode:e=>{console.log("[ChatPanel] onExecuteCode called, code:",e),c(e),f.clearEditor(),f.executeCode(e),setTimeout(()=>{i()},100)}});return(0,a.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,a.jsx)(A,{onWorkerReady:m.onWorkerReady,onShapeUpdate:W,onProgress:m.onProgress,onLog:m.onLog,onError:m.onError,autoEvaluateCode:q}),(0,a.jsx)("div",{className:"shrink-0 z-10",children:(0,a.jsx)(H,{onSaveProject:M,onLoadProject:L,onSaveSTEP:T,onSaveSTL:O,onSaveOBJ:U})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)(N,{editorPanel:I,cadViewPanel:F,consolePanel:z,editorTitle:t})}),(0,a.jsx)(Y,{isCADWorkerReady:r,isWorking:E,isWorkerReady:S,hasUnsavedChanges:o,error:R||void 0})]})}function eo(){return(0,a.jsx)($,{children:(0,a.jsx)(en,{})})}},5306:(e,t,r)=>{Promise.resolve().then(r.bind(r,5152))}},e=>{var t=t=>e(e.s=t);e.O(0,[845,367,831,332,441,684,358],()=>t(5306)),_N_E=e.O()}]);